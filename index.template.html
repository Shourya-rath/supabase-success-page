<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifying Account...</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Import Supabase.js -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div id="loading-state" class="text-center">
        <h1 class="text-2xl font-semibold">Verifying your email...</h1>
        <p>Please wait a moment.</p>
    </div>

    <div id="success-state" class="hidden bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-lg w-full text-center m-4">
        <!-- SVG for a success icon -->
        <svg class="h-20 w-20 text-emerald-500 mx-auto mb-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>

        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Account Confirmed!</h1>
        <p class="text-lg text-gray-600 mb-8">
            Your email address has been successfully verified. You can now return to the application and log in.
        </p>

        <!-- The button to redirect the user back to your app's login page -->
        <a href="https://your-app-domain.com/login" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-colors duration-300">
            Go to Login Page
        </a>
    </div>

    <script>
    // Placeholders will be replaced by GitHub Actions
    const supabaseUrl = '__SUPABASE_URL__';
    const supabaseAnonKey = '__SUPABASE_ANON_KEY__';
    
    // Create the Supabase client
    const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

    // This function runs on page load to check for a verification token
    async function handleAuthRedirect() {
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const tokenHash = params.get('token_hash');
        const type = params.get('type');
        const error = params.get('error_description');

        const statusMessage = document.getElementById('status-message');

        if (error) {
            // Display any error messages returned from Supabase
            statusMessage.innerHTML = `Verification failed: ${error}`;
            return;
        }

        if (tokenHash && type === 'email') {
            const { data, error } = await supabase.auth.verifyOtp({ token_hash: tokenHash, type: 'email' });

            if (error) {
                console.error('Verification error:', error);
                statusMessage.innerHTML = `Error verifying your account: ${error.message}`;
            } else {
                console.log('Verification successful:', data);
                // The account is now verified. You can update the UI.
                statusMessage.innerHTML = 'Account confirmed successfully! Redirecting you now...';
                // Redirect the user to your login page
                setTimeout(() => {
                    window.location.href = 'https://your-app-domain.com/login';
                }, 3000);
            }
        } else {
            // No token found, so just display a generic success message
            statusMessage.innerHTML = 'Your account has been confirmed.';
        }
    }

    // Call the function when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', handleAuthRedirect);
</script>
</body>
</html>
